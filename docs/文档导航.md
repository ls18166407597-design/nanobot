# 文档导航（总览入口）

本文件是项目文档的统一入口，解决“文档分散、职责不清”的问题。

## 1. 推荐阅读顺序

1. `PROJECT_OVERVIEW_CN.md`：先建立整体心智模型（运行流程、权限、故障处理）。
2. `ARCHITECTURE.md`：再看核心边界与契约（哪些层可以改、哪些必须守）。
3. `docs/项目结构.md`：看目录与分层职责，理解文件应该放在哪。
4. `workspace/IDENTITY.md` + `workspace/AGENTS.md` + `workspace/TOOLS.md`：看运行时提示词与行为规则。
5. `docs/配置指南.md`：最后看配置与部署操作。

## 2. 文档职责分工（按“回答什么问题”）

| 文档 | 主要回答的问题 | 什么时候看 |
| --- | --- | --- |
| `PROJECT_OVERVIEW_CN.md` | 系统怎么跑、主要模块怎么协作、怎么排障 | 新接手项目、做全局复盘 |
| `ARCHITECTURE.md` | 核心契约是什么、改动边界在哪里 | 改主干代码前 |
| `docs/项目结构.md` | 目录怎么分层、文件应该放哪 | 新增文件/重构目录前 |
| `docs/文件清单.md` | 某个文件在哪里、用途是什么 | 定位文件时 |
| `docs/配置指南.md` | 配置项怎么改、配置文件在哪 | 改配置与联调时 |
| `docs/配置字段中文对照.md` | 配置字段中文语义 | 配置审阅时 |
| `docs/MCP_GUIDE.md` | MCP 在本项目中的定位与用法 | 接入/排查 MCP 能力时 |
| `docs/CLI验收清单.md` | CLI 验证项和验收步骤 | 发布前自检 |
| `docs/路线图.md` | 演进方向与阶段目标 | 规划迭代时 |

## 2.1 单一事实源（SSOT）

为避免“同一规则在多处漂移”，以下主题只在主文档维护，其他文档只做引用：

- 架构边界与核心契约：`ARCHITECTURE.md`
- 配置项语义与改法：`docs/配置指南.md`
- 目录分层与放置规则：`docs/项目结构.md`
- 全量文件索引：`docs/文件清单.md`
- 运行时行为规则（注入模型）：`workspace/IDENTITY.md`、`workspace/AGENTS.md`、`workspace/TOOLS.md`

## 3. 运行时规则文档（Workspace）

| 文档 | 作用 | 优先级 |
| --- | --- | --- |
| `workspace/IDENTITY.md` | 角色、输出风格、执行边界 | 高 |
| `workspace/AGENTS.md` | 执行硬规则（安全、澄清、路由约束） | 高 |
| `workspace/TOOLS.md` | 工具分工与组合、配置路径 | 高 |
| `workspace/USER.md` | 用户偏好与使用约定 | 中 |
| `workspace/PROFILE.md` | 稳定用户画像字段（最小注入） | 中 |
| `workspace/HEARTBEAT.md` | 巡检/维护建议清单 | 中 |

说明：运行时提示词由 `nanobot/agent/context.py` 组装，核心注入顺序为 `IDENTITY -> AGENTS/USER/TOOLS -> PROFILE摘要 -> memory/skills摘要`。

## 4. 常见场景应该看哪份文档

1. “为什么 AI 这么回复？”  
看：`workspace/IDENTITY.md`、`workspace/AGENTS.md`、`workspace/TOOLS.md`、`nanobot/agent/context.py`

2. “为什么任务执行失败/不稳定？”  
看：`PROJECT_OVERVIEW_CN.md`（任务与故障章节）、`nanobot/agent/tools/task.py`、`nanobot/agent/task_manager.py`

3. “为什么工具来源显示这样？”  
看：`workspace/TOOLS.md`、`nanobot/agent/user_turn_service.py`

4. “这段代码应该放 tools 还是 scripts？”  
看：`docs/项目结构.md`（分层原则）

## 5. 维护约定

1. 新增核心文档时，必须同步更新本导航文件。
2. 若文档职责变更，优先更新本导航，再更新对应文档正文。
3. 避免同一规则写在多个文档里；主文档保留一处，其他文档只链接或简述。

## 6. 改动影响矩阵（改哪里就更新哪里）

1. 改 `nanobot/agent/turn_engine.py`、`nanobot/agent/loop.py`、`nanobot/agent/executor.py`  
必须更新：`ARCHITECTURE.md`、`PROJECT_OVERVIEW_CN.md`

2. 改 `nanobot/agent/tool_policy.py`、`nanobot/agent/tools/*.py`、`nanobot/agent/tool_bootstrapper.py`  
必须更新：`workspace/TOOLS.md`、`docs/配置指南.md`（如涉及配置）

3. 改 `nanobot/config/schema.py`、`.home/config.json` 相关字段语义  
必须更新：`docs/配置指南.md`、`docs/配置字段中文对照.md`

4. 改 `workspace/skills/*` 或 `workspace/scripts/*` 的目录规范  
必须更新：`docs/项目结构.md`、`workspace/scripts/README.md`（如有入口变化）

5. 新增/删除仓库文件  
必须更新：`docs/文件清单.md`

6. 改提示词装配链路（`nanobot/agent/context.py`）或规则文档注入顺序  
必须更新：`docs/项目结构.md`、`PROJECT_OVERVIEW_CN.md`
