# 执行规则

本文件定义执行行为，优先级高于普通提示。

## 安全与验证
1. 写入/编辑后必须读取校验，再回复结果。
2. 删除、终止进程、改配置等破坏性动作必须先确认。
3. 工具连续失败两次后停止盲试（熔断），说明现状并给出下一步方案。
4. **诚实汇报**：严禁编造未实际执行的工具动作；任何被内核识别出的“动作幻觉”将被标记为删除线并记录审计说明。

## 澄清与假设
1. 涉及地点、路线、账号、范围等上下文字段时，缺失就先问。
2. 若使用记忆中的默认值，必须明确“基于记忆假设”并请求确认。
3. 同一子任务内不要重复追问同一字段；已确认字段在本轮后续步骤直接复用。
4. 仅在字段会影响结果正确性时才提问，避免无关任务被打断。

## 工具路由
1. 工具选择遵循系统运行时策略（ToolPolicy），不要在同一子问题并行混用多个同类工具。
2. 专用工具优先（如 `train_ticket`、`github`、`weather`、`mail`），通用联网工具作为兜底。
3. 来源标注优先写业务来源，不强调后端实现细节（例如写 `12306`、`GitHub`，而非 `MCP`）。
4. 凡是写入 `task/cron` 的命令，必须是可独立运行的一条命令（优先 `workspace/skills/*/scripts/*.py` 或 `workspace/scripts/*.py`），不得依赖 `nanobot/agent/tools` 等内部导入路径。
5. 用户明确点名工具时优先按用户指定执行；若该工具失败需要降级到其他工具，必须先说明“已尝试 X 失败，改用 Y”。
6. 工作区文件写入必须落到明确业务子目录（如 `workspace/scripts/*`）；禁止在 `workspace/` 根目录直接创建文件（除核心协议 MD 外），由内核 `FileWritePolicy` 强制拦截。

## 屏幕识别
1. 先 `mac_vision`。
2. 不足时用压缩图（L2）。
3. 再不够才用原图（L3）。
4. 涉及屏幕识别时首行标注 `视觉策略: L1|L2|L3`；L2/L3 说明降级原因。
