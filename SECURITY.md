# 安全策略 (Security Policy)

## 漏洞报告

如果您在 Nanobot 中发现安全漏洞，请通过以下方式报告：

1. **不要** 开设公开的 GitHub Issue。
2. 在 GitHub 上创建私有安全公告 (Private Security Advisory) 或联系项目维护者。
3. 报告应包含：
   - 漏洞描述
   - 复现步骤
   - 潜在影响
   - 建议的修复方案（如有）

我们的目标是在 48 小时内对安全报告做出回应。

## 安全最佳实践

### 1. API 密钥管理

**关键提示**：严禁将 API 密钥提交至版本控制系统。

```bash
# ✅ 正确：存储在权限受限的本地配置文件中
chmod 600 [nanobot_home]/config.json

# ❌ 错误：硬编码在代码中或提交到 Git
```

**建议：**
- 将密钥存储在本地 `.home/config.json` 中，并将文件权限设置为 `0600`。
- 对于生产环境，优先使用环境变量或 OS 钥匙串管理凭据。

### 2. 渠道访问控制

**重要**：生产环境务必配置 `allowFrom` 白名单。

```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "token": "YOUR_BOT_TOKEN",
      "allowFrom": ["123456789"] 
    }
  }
}
```

- 如果 `allowFrom` 为空，系统默认**允许所有用户**访问（仅适用于个人本地调试）。
- 定期审查日志以排查异常访问。

### 3. Shell 命令执行 (Hardened V2.0)

`exec` 工具允许执行 Shell 命令。在 V2.0 架构中，我们引入了更严苛的保护：

- **内容哈希熔断**：系统会监测工具调用的参数内容。如果模型陷入逻辑循环（即使它生成了伪造的新 ID），只要指令内容重复，也会在第 4 轮被强制阻断。
- **深度路径审计**：系统会对命令中的绝对路径进行正则提取和实时校验。严禁在受限模式下访问工作区以外的敏感系统目录（如 `/etc`, `/var`）。
- **并发红线**：子智能体并发被严格压制在 3 个以内，防止恶意代码触发资源爆炸。

### 4. 文件系统安全

- ✅ 为 Nanobot 使用独立的非 root 系统用户。
- ✅ 开启 `restrict_to_workspace` 模式以确保文件操作仅限于项目目录内。

### 5. 网络安全

- 所有外部 API 调用强制使用 HTTPS。
- 配置了 10-60 秒的硬超时，防止挂起攻击。

### 6. 生产环境检查清单

在正式部署 Nanobot 前，请对照以下项：

- [ ] API 密钥未硬编码且存储安全。
- [ ] 配置文件权限已设为 `0600`。
- [ ] 所有消息渠道已配置 `allowFrom` 白名单。
- [ ] 运行用户为非 root 用户。
- [ ] 已开启 V2.0 架构加固开关（哈希检测与路径审计）。
- [ ] 已启用审计记录 (`audit.log`) 并定期监控。

---

**最后更新时间**：2025-02-10 (V2.0 Hardening Update)

有关最新的安全更新，请访问：
- GitHub 安全公告：https://github.com/HKUDS/nanobot/security/advisories
- 发行日志：https://github.com/HKUDS/nanobot/releases
